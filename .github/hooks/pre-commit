#!/bin/sh

#
# Pre-commit hook template for MongoDB Reindexer
#
# This hook validates project structure before allowing commits.
# To enable this hook:
#   bash scripts/setup-hooks.sh
#

echo "Running project structure validation..."

# Check if node and npm are available
if ! command -v node >/dev/null 2>&1; then
    echo "⚠️  Warning: Node.js not found in PATH"
    echo "Skipping validation (install Node.js to enable)"
    exit 0
fi

if ! command -v npm >/dev/null 2>&1; then
    echo "⚠️  Warning: npm not found in PATH"
    echo "Skipping validation (install npm to enable)"
    exit 0
fi

# Run the validation script
npm run validate:structure

# Capture exit code
VALIDATION_EXIT_CODE=$?

if [ $VALIDATION_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "❌ Pre-commit validation FAILED!"
    echo "Please fix the errors above before committing."
    echo ""
    echo "If you need to bypass this check (not recommended):"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

echo "✅ Pre-commit validation passed!"
exit 0
